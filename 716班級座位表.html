<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>716班級座位表</title>
  <style>
    :root { --primary:#3b82f6; --bg:#f8fafc; --card:#fff; --border:#e2e8f0; --male:#fff7cc; --female:#d1fae5; --text:#1e293b; --muted:#64748b; }
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:var(--bg);color:var(--text)}
    header{background:var(--card);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:10}
    .wrap{max-width:1200px;margin:0 auto;padding:12px}
    h1{font-size:18px;margin:0 0 8px}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .btn{padding:6px 12px;font-size:14px;border:1px solid var(--border);border-radius:6px;cursor:pointer;background:#fff}
    .btn:hover{border-color:#94a3b8}
    .btn-primary{background:var(--primary);color:#fff;border-color:var(--primary)}
    .grid-input{width:50px;padding:4px;border:1px solid var(--border);border-radius:4px;margin-left:4px}

    main{max-width:1200px;margin:10px auto;display:grid;grid-template-columns:300px 1fr;gap:12px;padding:0 12px}
    .panel{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:12px}
    .pool{display:flex;flex-wrap:wrap;gap:8px;min-height:200px;border:2px dashed var(--border);border-radius:8px;padding:8px;background:#f9fafb}
    .student{background:#fff;border:1px solid var(--border);border-radius:8px;padding:6px 10px;display:inline-flex;align-items:center;gap:6px;cursor:grab;font-size:14px}
    .student[data-g="M"]{background:var(--male)}
    .student[data-g="F"]{background:var(--female)}
    .num{background:#1e293b;color:#fff;border-radius:50%;width:20px;height:20px;display:flex;align-items:center;justify-content:center;font-size:12px}

    .grid{--rows:5;--cols:6;display:grid;grid-template-columns:repeat(var(--cols),minmax(80px,1fr));gap:8px}
    .seat{min-height:70px;border:2px dashed var(--border);border-radius:8px;position:relative;display:flex;align-items:center;justify-content:center;background:#fff}
    .seat.occupied{border-style:solid}
    .label{position:absolute;top:4px;left:4px;font-size:12px;color:var(--muted);background:#f1f5f9;padding:1px 4px;border-radius:4px}
    .seat.drag{border-color:var(--primary);background:#f0f9ff}

    /* 講台樣式 */
    .podium{display:flex;align-items:center;justify-content:center;height:44px;margin:8px 0 12px;background:#fff;border:2px solid var(--border);border-radius:10px;font-weight:700;color:var(--muted);letter-spacing:2px}

    .legend{display:flex;align-items:center;gap:16px;margin:6px 0 10px;color:var(--muted);font-size:14px}
    .legend .dot{display:inline-block;width:14px;height:14px;border-radius:3px;margin-right:6px;border:1px solid var(--border)}
    .legend .female{background:var(--female)}
    .legend .male{background:var(--male)}

    .col-header{display:grid;grid-template-columns:repeat(var(--cols),minmax(80px,1fr));gap:8px;margin:6px 0}
    .header-badge{background:#fff;border:1px solid var(--border);border-radius:999px;padding:4px 10px;font-size:12px;color:var(--muted);text-align:center;box-shadow:0 1px 0 rgba(0,0,0,.03)}

    .board{display:grid;grid-template-columns:36px 1fr;gap:8px}
    .row-rail{display:grid;grid-template-rows:repeat(var(--rows),70px);gap:8px}
    .rail-badge{display:flex;align-items:center;justify-content:center;background:#fff;border:1px solid var(--border);border-radius:999px;font-size:12px;color:var(--muted)}

    /* 列印樣式：只保留座位表 */
    @media print{
      header,aside{display:none!important}
      body{background:#fff}
      main{grid-template-columns:1fr!important}
      .panel{border:none;box-shadow:none}
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>716班級座位表</h1>
      <div class="toolbar">
        <button class="btn btn-primary" onclick="quickAdd()">➕ 新增學生</button>
        <button class="btn" onclick="quickBulk()">📋 批次新增</button>
        <button class="btn" onclick="window.print()">🖨️ 列印座位表</button>
        <button class="btn" onclick="clearSeats()">🗑️ 清空座位表</button>
        <span style="margin-left:auto;font-size:14px;">列:<input id="rowInput" type="number" class="grid-input" min="1" max="12" value="5"> 行:<input id="colInput" type="number" class="grid-input" min="1" max="12" value="6"> <button class="btn" onclick="updateGrid()">更新</button></span>
      </div>
    </div>
  </header>

  <main>
    <aside class="panel">
      <h3 style="margin:0 0 8px;font-size:15px">學生池</h3>
      <div id="pool" class="pool"></div>
      <div style="font-size:12px;color:var(--muted);margin-top:6px">提示：輸入「座號 姓名」或「姓名, M/F」。未填性別時，1–25 女、26+ 男。</div>
    </aside>
    <section class="panel">
      <h3 style="margin:0 0 8px;font-size:15px">座位區</h3>
      <div class="podium" aria-label="講台">講台</div>
      <div class="legend"><span class="dot female"></span>女生　<span class="dot male"></span>男生</div>
      <div id="colHeader" class="col-header"></div>
      <div class="board">
        <div id="rowRail" class="row-rail"></div>
        <div id="grid" class="grid"></div>
      </div>
    </section>
  </main>

  <script>
    const state={rows:5,cols:6,students:[],seats:{}};
    const poolEl=document.getElementById('pool');
    const gridEl=document.getElementById('grid');
    const colHeaderEl=document.getElementById('colHeader');
    const rowRailEl=document.getElementById('rowRail');

    renderGrid();renderPool();

    function renderGrid(){
      gridEl.style.setProperty('--rows',state.rows);
      gridEl.style.setProperty('--cols',state.cols);
      if(colHeaderEl){
        colHeaderEl.style.setProperty('--cols',state.cols);
        colHeaderEl.innerHTML='';
        for(let c=1;c<=state.cols;c++){
          const b=document.createElement('div'); b.className='header-badge'; b.textContent=String(c); colHeaderEl.appendChild(b);
        }
      }
      if(rowRailEl){
        rowRailEl.style.setProperty('--rows',state.rows);
        rowRailEl.innerHTML='';
        for(let r=1;r<=state.rows;r++){
          const b=document.createElement('div'); b.className='rail-badge'; b.textContent=String(r); rowRailEl.appendChild(b);
        }
      }
      gridEl.innerHTML='';
      for(let r=1;r<=state.rows;r++){
        for(let c=1;c<=state.cols;c++){
          const key=`r${r}c${c}`;
          const seat=document.createElement('div');
          seat.className='seat'; seat.dataset.key=key;
          seat.innerHTML=`<span class="label">${c}-${r}</span>`;
          enableDrop(seat);
          const sid=state.seats[key];
          if(sid){const stu=state.students.find(s=>s.id===sid);if(stu) occupySeat(seat,stu);}    
          gridEl.appendChild(seat);
        }
      }
    }

    function renderPool(){
      poolEl.innerHTML='';
      const assigned=new Set(Object.values(state.seats));
      state.students.filter(s=>!assigned.has(s.id)).forEach(stu=>poolEl.appendChild(card(stu)));
      enableDrop(poolEl,true);
    }

    function card(stu){
      const el=document.createElement('div');
      el.className='student'; el.draggable=true; el.id=stu.id; el.dataset.g=stu.gender||'';
      el.innerHTML=`<span class="num">${stu.number??'?'}</span><span>${stu.name}</span>`;
      el.addEventListener('dragstart',e=>{e.dataTransfer.setData('text/plain',stu.id);});
      return el;
    }

    function occupySeat(seat,stu){
      seat.classList.add('occupied');
      const label=seat.querySelector('.label');
      seat.innerHTML=''; seat.appendChild(label);
      const c=card(stu); c.style.width='100%'; c.style.justifyContent='center';
      seat.appendChild(c);
    }

    function enableDrop(target,isPool=false){
      target.addEventListener('dragover',e=>{e.preventDefault();target.classList.add('drag');});
      target.addEventListener('dragleave',()=>target.classList.remove('drag'));
      target.addEventListener('drop',e=>{
        e.preventDefault();target.classList.remove('drag');
        const sid=e.dataTransfer.getData('text/plain'); if(!sid) return;
        if(isPool){removeFromSeat(sid);renderGrid();renderPool();return;}
        const key=target.dataset.key; placeToSeat(sid,key);
      });
    }

    function placeToSeat(studentId,key){
      const fromKey=Object.entries(state.seats).find(([k,v])=>v===studentId)?.[0];
      if(fromKey) delete state.seats[fromKey];
      state.seats[key]=studentId; renderGrid(); renderPool();
    }
    function removeFromSeat(id){for(const [k,v] of Object.entries(state.seats)){if(v===id) delete state.seats[k];}}

    function quickAdd(){
      const input=prompt('輸入「座號 姓名」或「姓名, M/F」');
      if(!input) return;
      const m=input.match(/^(\d+)\s+(.+)$/);
      if(m){const num=parseInt(m[1]);const name=m[2].trim();const g=num<=25?'F':'M';addStu(num,name,g);} 
      else{const parts=input.split(',');const name=(parts[0]||'').trim();let g=(parts[1]||'').trim().toUpperCase();if(g!=='M'&&g!=='F') g='';addStu(null,name,g);} }

    function quickBulk(){
      const txt=prompt('每行輸入「座號 姓名」'); if(!txt) return;
      txt.split(/\r?\n/).forEach(line=>{const m=line.trim().match(/^(\d+)\s+(.+)$/); if(m){const num=parseInt(m[1]);const name=m[2].trim();const g=num<=25?'F':'M';addStu(num,name,g);}});
    }

    function addStu(number,name,gender){
      if(!name) return;
      state.students.push({id:'s'+Date.now()+Math.random().toString(36).slice(2,9),number,name,gender});
      renderPool();
    }

    function updateGrid(){
      const r=parseInt(document.getElementById('rowInput').value)||5;
      const c=parseInt(document.getElementById('colInput').value)||6;
      state.rows=Math.max(1,Math.min(12,r));
      state.cols=Math.max(1,Math.min(12,c));
      for(const key of Object.keys(state.seats)){
        const m=key.match(/^r(\d+)c(\d+)$/); if(!m) continue;
        const rr=parseInt(m[1]), cc=parseInt(m[2]);
        if(rr>state.rows || cc>state.cols) delete state.seats[key];
      }
      renderGrid(); renderPool();
    }

    function clearSeats(){
      if(confirm('確定要清空所有座位安排嗎？')){
        state.seats={};
        renderGrid(); renderPool();
      }
    }
  </script>
</body>
</html>